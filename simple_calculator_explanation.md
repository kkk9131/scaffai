# 簡易計算機能について

## 概要

このプロジェクトには、webアプリケーションとmobileアプリケーション（React Native/Expo）の両方に実装された「簡易計算機能」があります。これは足場（scaffold）の設計と計算を行うための機能で、建設現場で使用される足場の寸法計算を自動化します。

## 機能の詳細

### 主要機能
1. **基本構造計算**: 足場の基本寸法（南北・東西のスパン）を計算
2. **隙間計算**: 各方向（北・南・東・西）の隙間を計算
3. **高さ計算**: ジャッキアップ高さや第1層高さを計算
4. **部材計算**: 必要なモジュール数や段数を算出
5. **制約チェック**: タイ可能性やタイ支柱の使用可否を判定

### 入力項目

#### 基本寸法
- **躯体幅**: 南北方向・東西方向の建物寸法
- **軒の出**: 各方向（北・東・南・西）の軒の出寸法
- **基準高さ**: 足場の基準となる高さ

#### 設定項目
- **屋根形状**: フラット・勾配軒・陸屋根から選択
- **境界線**: 各方向の境界線指定（boolean）
- **根がらみ支柱**: 使用有無の設定
- **軒先手すり**: 手すりの段数

#### 特殊部材
- **355mm部材**: 使用数量
- **300mm部材**: 使用数量  
- **150mm部材**: 使用数量

#### 目標離れ設定
- 各方向に対して個別の目標離れ値を設定可能

### 計算結果

#### 基本構造情報
- **南北総スパン** (mm)
- **東西総スパン** (mm)
- **段数**
- **モジュール数**

#### 隙間情報
- **北側隙間**
- **南側隙間**
- **東側隙間**
- **西側隙間**

#### 高さ情報
- **ジャッキアップ高さ** (mm)
- **第1層高さ** (mm)

#### ステータス
- **タイ可能**: OK/NG
- **タイ支柱使用**: 使用/未使用

#### 構造詳細
- **南北方向構造**: スパン構成の詳細
- **東西方向構造**: スパン構成の詳細

## 技術実装

### 共通計算エンジン
- **`mobile-engine.ts`**: Webアプリとモバイルアプリで共通の計算ロジック
- 両プラットフォームで100%同じ計算結果を保証

### Web版実装
- **ページ**: `/calculator`
- **コンポーネント**: `CalculatorForm.tsx`
- **結果表示**: グラデーション背景の詳細な結果画面
- **図面プレビュー**: `DrawingCanvas`による建物平面図の表示

### Mobile版実装
- **画面**: `input.tsx` (入力画面)
- **結果画面**: `result.tsx`
- **追加機能**: `quick-allocation.tsx` (簡易割付計算)

### モバイル固有機能

#### 簡易割付計算
モバイル版には追加で「簡易割付計算」機能があります：

- **計算式**: `現在の離れ + 割付距離 - 足場スパン構成 = 割付先の離れ`
- **目標**: 制約を満たす中で最小の離れとなる足場スパン構成を選択
- **特殊部材対応**: 355mm、300mm、150mm部材の使用を考慮
- **補正機能**: 必要に応じて補正部材（300mm、150mm）による調整

#### 電卓モード
- **平面計算**: スパン距離の加算・減算
- **立面計算**: 最大梁高・ジャッキアップ高さからの計算

## ファイル構成

### Web版
```
apps/web/
├── app/calculator/page.tsx          # メイン計算ページ
├── components/Calculator/
│   └── CalculatorForm.tsx          # 入力フォーム
├── lib/calculator/
│   ├── mobile-engine.ts            # 共通計算エンジン
│   ├── types.ts                    # 型定義
│   └── utils.ts                    # ユーティリティ
└── tests/e2e/calculator.spec.ts    # E2Eテスト
```

### Mobile版
```
apps/mobile/
├── app/(drawer)/
│   ├── input.tsx                   # 入力画面
│   ├── result.tsx                  # 結果画面
│   └── quick-allocation.tsx        # 簡易割付計算
├── utils/
│   └── quickAllocationCalculator.ts # 割付計算ロジック
└── context/ScaffoldContext.tsx     # 状態管理
```

## 使用用途

この簡易計算機能は、建設現場で足場を設置する際の事前計算に使用されます：

1. **設計段階**: 建物寸法から必要な足場構成を算出
2. **見積作成**: 必要部材数の算出
3. **現場作業**: 実際の設置時の寸法確認
4. **割付計算**: 既存足場への追加・変更時の計算

## 注意事項

- 計算ロジックは完成されており、今後の変更は最小限に留める方針
- Web版とMobile版で計算結果の一貫性を保つため、共通エンジンを使用
- モバイル版の方がより高度な割付計算機能を持つ