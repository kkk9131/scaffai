# 足場総スパン自動計算ロジック解説

## 1. 概要

このドキュメントは、ScaffAIのWeb版作図エディターにおける「自動生成機能」の根幹をなす、足場総スパンの自動計算ロジックについて解説します。

ユーザーが入力した簡易的な建物情報から、安全基準を満たしつつ、経済的（部材が最小）となる足場の寸法を自動的に算出することを目的としています。

## 2. 計算の基本フロー

計算は以下の流れで実行されます。

1.  **ユーザー入力**: ユーザーが簡易計算画面で以下の情報を入力します。
    *   建物の南北方向の長さ
    *   建物の東西方向の長さ
    *   4方向（北・南・東・西）の軒の出の長さ

2.  **最小離れの算出**: 各面において、安全な作業スペースを確保するために必要な最小の離れ（建物と足場の間の距離）を計算します。

3.  **最小総スパンの決定**: 算出された最小離れを確保できる、最も経済的な（＝長さが最短となる）足場の総スパンを、標準部材の組み合わせから探索します。

4.  **結果の出力**: 計算された「東西方向の総スパン」「南北方向の総スパン」「4方向の具体的な離れ」を出力します。

## 3. 計算ロジックの詳細

### 3.1 基本的な制約条件

現在の計算ロジックは、以下の制約に基づいています。

*   **境界線の考慮**: `なし`
    *   隣地境界線などの物理的な制約がない、オープンな環境を前提とします。
*   **使用部材**: `標準部材のみ`
    *   計算には `1800mm, 1500mm, 1200mm, 900mm, 600mm` の5種類の標準部材のみを使用します。
    *   `150mm, 300mm, 355mm` などの特殊部材は、ユーザーによる明示的な選択がない限り使用しません。
*   **目標離れの指定**: `なし`
    *   ユーザーが特定の離れを指定する機能は考慮せず、後述の安全マージンを確保できる最小値を自動で算出します。

### 3.2 ロジックの核心：最小離れの確保

計算ロジックの最も重要な点は、**「離れ >= 軒の出 + 80mm」** という安全基準を満たすことです。

この条件を満たした上で、総スパンが最短となる部材の組み合わせを見つけ出すことが、この機能の核心となります。

## 4. 具体的な計算例

**入力情報:**

*   建物の南北方向の長さ: `5,000 mm`
*   建物の東西方向の長さ: `10,000 mm`
*   軒の出（全方向）: `1,000 mm`

---

### 4.1 東西方向の総スパン（北面・南面の足場）の計算

1.  **必要な最小離れの計算**:
    *   `軒の出 (1,000mm) + 安全マージン (80mm) = 1,080mm`
    *   北面、南面ともに最低でも `1,080mm` の離れが必要です。

2.  **必要な総スパンの最小値の計算**:
    *   `建物幅 (10,000mm) + 北側離れ (1,080mm) + 南側離れ (1,080mm) = 12,160mm`
    *   足場の総スパンは、最低でも `12,160mm` 必要になります。

3.  **最適なスパン構成の探索**:
    *   総スパンが `12,160mm` 以上となる、標準部材の最小の組み合わせを探します。
    *   計算の結果、`基本スパン(9,000mm) + 調整部材(1,800mm + 1,500mm) = 12,300mm` が選択されます。

4.  **東西方向の計算結果**:
    *   **総スパン**: `12,300 mm`
    *   **確保される離れ**: `(12,300mm - 10,000mm) / 2 = 1,150 mm` (これは `1,080mm` の条件を満たします)

---

### 4.2 南北方向の総スパン（東面・西面の足場）の計算

1.  **必要な最小離れの計算**:
    *   東西方向と同様に `1,080mm` が必要です。

2.  **必要な総スパンの最小値の計算**:
    *   `建物幅 (5,000mm) + 東側離れ (1,080mm) + 西側離れ (1,080mm) = 7,160mm`

3.  **最適なスパン構成の探索**:
    *   総スパンが `7,160mm` 以上となる最小の組み合わせを探します。
    *   計算の結果、`基本スパン(3,600mm) + 調整部材(1,800mm + 1,800mm) = 7,200mm` が選択されます。

4.  **南北方向の計算結果**:
    *   **総スパン**: `7,200 mm`
    *   **確保される離れ**: `(7,200mm - 5,000mm) / 2 = 1,100 mm` (これも `1,080mm` の条件を満たします)

---

## 5. 【応用】入隅（いりすみ）部分の計算ロジック

L字型など、建物に入隅部分が存在する場合の計算ロジックについて解説します。

### 5.1 計算の基本方針

- **外周の離れを基準とする**: 入隅部分の計算には、簡易計算で先に求めた「外周部分の離れ」を基準値として利用します。
- **垂直な辺の情報を利用する**: ある入隅の辺の離れを計算するには、その辺に垂直に接続している、もう一方の入隅の辺の「長さ」と「スパン構成」が重要な要素となります。

### 5.2 具体的な計算例

**前提条件:**

- **建物形状**: 以下のようなL字型
  ```
   1---2
   |   |
   |   3--4
   |      |
   6------5
  ```
- **辺の情報**:
  - 辺1-2, 3-4: 北向き
  - 辺2-3, 4-5: 東向き
  - 辺2-3の長さ: `1,000 mm`
  - 辺3-4の長さ: `2,500 mm`
- **軒の出**: `1,000 mm` (全周)
- **外周の離れ**: 北面 `1,100 mm`, 東面 `1,100 mm` (簡易計算からの引継ぎ値)
- **安全な離れの最小値**: `1000mm (軒の出) + 80mm = 1080mm`

#### ケース1: 辺3-4（北向き入隅）の離れを求める

1.  **計算式の組み立て**:
    - 基準: 北向きの外周の離れ (辺1-2)
    - 利用する辺: 垂直に接続する辺2-3の長さ
    - `離れ(辺3-4) = 離れ(辺1-2) + 長さ(辺2-3) - [辺2-3のスパン構成]`

2.  **最適なスパン構成の探索**:
    - `離れ(辺3-4) = 1100 + 1000 - [スパン] = 2100 - [スパン]`
    - この結果が `1080mm` 以上で最小になる `[スパン]` を探します。
    - `2100 - [スパン] >= 1080`  => `[スパン] <= 1020`
    - 条件を満たす最大のスパンは `[900]` です。

3.  **計算結果**:
    - **辺2-3に組むべきスパン**: `900 mm`
    - **辺3-4の離れ**: `2100 - 900 = 1200 mm`

#### ケース2: 辺2-3（東向き入隅）の離れを求める

1.  **計算式の組み立て**:
    - 基準: 東向きの外周の離れ (辺4-5)
    - 利用する辺: 垂直に接続する辺3-4の長さ
    - `離れ(辺2-3) = 離れ(辺4-5) + 長さ(辺3-4) - [辺3-4のスパン構成]`

2.  **最適なスパン構成の探索**:
    - `離れ(辺2-3) = 1100 + 2500 - [スパン] = 3600 - [スパン]`
    - この結果が `1080mm` 以上で最小になる `[スパン]` を探します。
    - `3600 - [スパン] >= 1080` => `[スパン] <= 2520`
    - 条件を満たす最大のスパン構成は `[1800, 600]` (合計 `2400mm`) です。

3.  **計算結果**:
    - **辺3-4に組むべきスパン**: `2400 mm`
    - **辺2-3の離れ**: `3600 - 2400 = 1200 mm`
