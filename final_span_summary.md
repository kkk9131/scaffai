# 指定寸法での全辺スパン構成計算結果

## 建物概要
- **建物形状**: L字型
- **軒の出**: 1000mm（全周）
- **基本離れ**: 150mm（全面共通）

## 建物レイアウト
```
1---2  （辺0: 250mm）
|   |
|   3--4  （辺1: 1000mm → 辺2: 2500mm）
|      |
6------5  （辺3: 9000mm）
        （辺4: 5000mm, 辺5: 10000mm）
```

## 各辺の詳細スパン構成

### 表形式サマリー
| 辺番号 | 対応面 | 建物寸法 | スパン構成 | スパン合計 | 計算種別 |
|--------|--------|----------|------------|------------|----------|
| 辺0 | 北面 | 250mm | [600] | 600mm | 出隅配分 |
| 辺1 | 東面 | 1000mm | [900, 600] + [600, 600] | 2700mm | 入隅 + 出隅 |
| 辺2 | 北面 | 2500mm | [1800, 600, 600] + [1800, 1800, 600] | 7200mm | 入隅 + 出隅 |
| 辺3 | 東面 | 9000mm | [1800, 1800, 1200, 600] | 5400mm | 出隅配分 |
| 辺4 | 西面 | 5000mm | [1800, 1800, 1800, 1800] | 7200mm | 独立配分 |
| 辺5 | 南面 | 10000mm | [1800, 1800, 1800] | 5400mm | 独立配分 |

## 計算プロセス詳細

### 1. 入隅計算（辺1、辺2）

#### 辺1（2→3）の入隅計算
- **対応面**: 東面
- **基本離れ**: 150mm
- **割付距離**: 1000mm（辺1の建物寸法）
- **計算**: 150mm + 1000mm = 1150mm
- **入隅スパン**: [900, 600] = 1500mm
- **結果離れ**: 150 + 1000 - 1500 = -350mm

#### 辺2（3→4）の入隅計算
- **対応面**: 北面
- **基本離れ**: 150mm
- **割付距離**: 2500mm（辺2の建物寸法）
- **計算**: 150mm + 2500mm = 2650mm
- **入隅スパン**: [1800, 600, 600] = 3000mm
- **結果離れ**: 150 + 2500 - 3000 = -350mm

### 2. 出隅スパン配分

#### 北面（辺0 + 辺2）
- **総スパン**: 7200mm
- **入隅使用スパン**: 3000mm（辺2の入隅部分）
- **残りスパン**: 4200mm
- **配分方針**: 実際の建物長さに応じて配分
  - 辺0（250mm、短い）: 420mm → [600]
  - 辺2追加（2500mm、長い）: 3780mm → [1800, 1800, 600]

#### 東面（辺1 + 辺3）
- **総スパン**: 7200mm
- **入隅使用スパン**: 1500mm（辺1の入隅部分）
- **残りスパン**: 5700mm
- **配分方針**: 実際の建物長さに応じて配分
  - 辺1追加（1000mm、短い）: 855mm → [600, 600]
  - 辺3（9000mm、長い）: 4845mm → [1800, 1800, 1200, 600]

#### 西面（辺4のみ）
- **総スパン**: 7200mm
- **配分**: [1800, 1800, 1800, 1800]

#### 南面（辺5のみ）
- **総スパン**: 5400mm
- **配分**: [1800, 1800, 1800]

## 面別スパン検証

| 面 | 辺構成 | スパン合計 | 設定総スパン | 差異 |
|----|--------|------------|--------------|------|
| 北面 | 辺0(600) + 辺2(7200) | 7800mm | 7200mm | +600mm |
| 東面 | 辺1(2700) + 辺3(5400) | 8100mm | 7200mm | +900mm |
| 西面 | 辺4のみ | 7200mm | 7200mm | 0mm |
| 南面 | 辺5のみ | 5400mm | 5400mm | 0mm |

## 重要なポイント

### 入隅計算の特徴
1. **入隅公式**: 現在の離れ + 割付距離 - 足場スパン構成 = 結果離れ
2. **辺1と辺2の入れ替え**: コード上で辺1の結果を辺2に、辺2の結果を辺1に格納する処理がある
3. **負の離れ**: 計算結果が負になるのは、スパン構成が必要距離を上回るため

### 出隅配分の特徴
1. **建物長さ比例**: 実際の建物寸法に応じてスパンを配分
2. **面ごとの処理**: 各面の総スパンから入隅分を差し引いて残りを配分
3. **1800mm基準**: 基本的に1800mmスパンを主体とした構成

### 実装上の確認事項
1. **面判定ロジック**: advancedInsideCornerCalculator.tsの88-104行目の`determineFaceByEdgeIndex`関数
2. **配分処理**: 同ファイルの437-556行目の面別特別処理
3. **入隅検出**: geometryCalculator.tsの入隅判定ロジック（角度180度未満）