# Web版作図エディタ機能一覧

## 概要
現在のWeb版作図エディタは、足場計算結果を基にした建物・足場の作図、編集、管理を行うための高機能なCADツールです。HTML5 Canvas とReact-Konvaを使用した2つのエディタエンジンを搭載し、建設業務に特化した専門的な図面作成機能を提供しています。

## 主要機能

### 1. 基本作図機能

#### 1.1 キャンバス操作
- **ズーム/パン操作**: マウスホイールや専用ボタンでの拡大縮小、ドラッグでの画面移動
- **グリッド表示**: 100mm/500mm単位の動的グリッド表示、グリッドスナップ機能
- **ビューリセット**: ワンクリックで初期表示状態に復帰
- **スケール表示**: 現在のズーム倍率をリアルタイム表示

#### 1.2 図形描画
- **多角形建物**: 任意の頂点数による複雑な建物形状の作成
- **頂点操作**: 頂点の追加、削除、ドラッグ移動
- **辺編集**: 建物外周の辺を個別に編集
- **寸法表示**: 各辺の実寸法（mm単位）をリアルタイム表示

### 2. 階層管理システム

#### 2.1 多階層対応
- **階層別作図**: 1F、2F、3F等の階層別に独立した図面作成
- **階層切り替え**: タブクリックによる瞬時の階層切り替え
- **階層カラー**: 各階層を色分けして視覚的に識別
- **階層数**: 最大5階層まで対応（拡張可能）

#### 2.2 階層間コピー機能
- **ドラッグ&ドロップ**: 階層タブ間のドラッグ&ドロップで建物形状をコピー
- **座標保持**: 元の階層と同じ座標でコピー
- **データ継承**: 頂点・軒の出データを継承、開口部は新規作成

#### 2.3 作図モード
- **編集モード**: 個別階層の詳細編集
- **作図モード**: 全階層を重ね合わせた複合表示

### 3. 軒の出・庇設計

#### 3.1 軒の出設定
- **辺別個別設定**: 各辺に対して独立した軒の出距離設定
- **リアルタイム調整**: スライダーまたは数値入力での即座反映
- **範囲**: 0-2000mm（0.1mm単位での精密設定）
- **一括設定**: 全辺を平均値に統一する機能

#### 3.2 軒の出表示
- **視覚化**: 点線による軒の出ラインの表示
- **寸法表示**: 各軒の出距離をmm単位で表示
- **カラー表示**: 階層ごとの色分け表示

### 4. 開口部管理システム

#### 4.1 開口部種類
- **玄関**: 900mm（標準）
- **勝手口**: 800mm（標準）
- **掃出し窓**: 1800mm（標準）
- **ガレージ**: 2500mm（標準）
- **通路**: 1200mm（標準）

#### 4.2 開口部作成
- **2点指定方式**: 辺上の開始点と終了点をクリックで指定
- **リアルタイム作成**: クリック操作による直感的な開口部作成
- **サイズ調整**: 標準サイズから手動調整可能
- **視覚表示**: 点線表示による開口部の明確な識別

#### 4.3 開口部編集
- **個別削除**: 作成済み開口部の個別削除
- **寸法表示**: 開口部幅の表示（オプション）
- **一覧管理**: 右パネルでの開口部リスト表示

### 5. 寸法・計測機能

#### 5.1 自動寸法表示
- **辺長表示**: 各辺の実際の長さを自動計算・表示
- **軒の出寸法**: 軒の出距離の表示
- **開口部寸法**: 開口部幅の表示

#### 5.2 寸法編集
- **クリック編集**: 寸法テキストクリックでモーダル編集
- **数値入力**: 直接数値入力による寸法変更
- **バリデーション**: 不正な値の入力防止

### 6. 自動生成機能

#### 6.1 足場ライン自動生成
- **計算結果連携**: 足場計算結果から自動的に足場ラインを生成
- **離れ距離反映**: 計算された東西南北の離れ距離を正確に反映
- **建物+足場**: 建物図面と足場ライン図面を同時生成

#### 6.2 データ連携
- **セッション連携**: 計算機からのデータを自動取得
- **URLパラメータ**: `?auto=true`による自動生成モード
- **リアルタイム反映**: 計算結果の変更を即座に図面に反映

### 7. ツールバー・UI機能

#### 7.1 左ツールバー
- **選択ツール**: オブジェクトの選択・移動
- **パンツール**: 画面の移動
- **ズームツール**: 拡大・縮小操作
- **グリッドトグル**: グリッド表示のON/OFF

#### 7.2 右プロパティパネル
- **階層管理**: 階層の追加・切り替え
- **頂点操作**: 頂点数表示・削除機能
- **軒の出調整**: スライダー・数値入力
- **開口部管理**: 種類選択・作成・削除

#### 7.3 パネル操作
- **折りたたみ機能**: 左右パネルの展開・収納
- **レスポンシブUI**: 画面サイズに応じた最適化

### 8. 図面インポート機能

#### 8.1 対応ファイル形式
- **PDF**: PDF図面の読み込み
- **DXF**: CADファイルの読み込み

#### 8.2 変換機能
- **スケール設定**: 図面縮尺の設定
- **レイヤー選択**: DXFレイヤーの選択的読み込み
- **点指定**: 手動による補助点の追加

### 9. 技術仕様

#### 9.1 描画エンジン
- **HTML5 Canvas**: メイン描画エンジン
- **React-Konva**: 代替描画エンジン（高度な操作用）
- **ダブルバッファリング**: 滑らかな描画更新

#### 9.2 計算精度
- **座標精度**: ピクセル単位での正確な座標管理
- **寸法精度**: 0.1mm単位での精密計算
- **スケール計算**: 動的スケール調整による正確な寸法表示

#### 9.3 パフォーマンス
- **リアルタイム更新**: 操作に対する即座の画面反映
- **メモリ管理**: 効率的なステート管理
- **レスポンシブ**: 60FPS滑らかなアニメーション

### 10. データ管理

#### 10.1 保存・復元
- **セッションストレージ**: ブラウザセッション内でのデータ保持
- **JSON形式**: 構造化されたデータ保存
- **自動保存**: 操作の自動保存

#### 10.2 データ構造
```typescript
interface FloorData {
  id: string;           // 階層ID
  name: string;         // 階層名（1F, 2F等）
  height: number;       // 階高（mm）
  vertices: BuildingVertex[];  // 頂点配列
  eaves: EdgeEave[];    // 軒の出配列
  openings: Opening[];  // 開口部配列
  visible: boolean;     // 表示状態
}
```

### 11. キーボードショートカット
- **Delete**: 選択した頂点の削除
- **Ctrl+Z**: 操作の取り消し（計画中）
- **Ctrl+Y**: 操作のやり直し（計画中）

### 12. エラーハンドリング・バリデーション
- **入力値検証**: 不正な数値入力の防止
- **境界チェック**: 座標・寸法の妥当性検証
- **エラー表示**: ユーザーフレンドリーなエラーメッセージ

## 今後の拡張予定
- エクスポート機能（PDF、DXF、PNG）
- アンドゥ・リドゥ機能
- 図面テンプレート機能
- 寸法線自動配置
- 面積・周長自動計算
- 3D表示機能

## まとめ
現在のWeb版作図エディタは、建設業界の足場設計に特化した包括的な機能を提供しており、直感的な操作性と専門的な精度を両立した実用的なCADツールとなっています。